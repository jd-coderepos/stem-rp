Understanding the exergy losses stemming from heat transfer in compressors and expanders is important for many energy storage applications such as compressed air and pumped thermal storage. In order to obtain a better understanding of these losses, CFD simulations were performed for simple gas springs, for a gas spring with an internal grid to mimic valve flow, and for a reciprocating compressor with functioning inlet and outlet valves. The wall heat exchanges for these three cases were examined and compared. The model adopted has previously been validated for a simple gas spring using experimental data from literature. For the gas spring with an internal grid it was found that increased mixing leads to higher heat-transfer-induced hysteresis losses and (at high piston speeds) to a significant pressure loss. These two types of loss can be distinguished by undertaking adiabatic-wall calculations. For a compressor (i.e., with valve flows) heat transfer over the cycle depends very much on valve timing. For example, at 1500rpm, when the delivery valve is opened at 7bar the heat transfer coefficient for the initial stages of compression is similar to that for a simple gas spring, whereas for the same speed at 6bar it is more than doubled.