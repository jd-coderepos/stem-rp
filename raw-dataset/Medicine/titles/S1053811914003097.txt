Efficient gradient computation for dynamical models 