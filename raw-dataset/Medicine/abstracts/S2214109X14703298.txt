Summary Background WHO recommends daily co-trimoxazole for children born to HIV-infected mothers from 6 weeks of age until breastfeeding cessation and exclusion of HIV infection. We have previously reported on the effectiveness of continuation of co-trimoxazole prophylaxis up to age 2 years in these children. We assessed the protective efficacy and safety of prolonging co-trimoxazole prophylaxis until age 4 years in HIV-exposed children. Methods We undertook an open-label randomised controlled trial alongside two observational cohorts in eastern Uganda, an area with high HIV prevalence, malaria transmission intensity, and antifolate resistance. We enrolled HIV-exposed infants between 6 weeks and 9 months of age and prescribed them daily co-trimoxazole until breastfeeding cessation and HIV-status confirmation. At the end of breastfeeding, children who remained HIV-uninfected were randomly assigned (1:1) to discontinue co-trimoxazole or to continue taking it up to age 2 years. At age 2 years, children who continued co-trimoxazole prophylaxis were randomly assigned (1:1) to discontinue or continue prophylaxis from age 2 years to age 4 years. The primary outcome was incidence of malaria (defined as the number of treatments for new episodes of malaria diagnosed with positive thick smear) at age 4 years. For additional comparisons, we observed 48 HIV-infected children who took continuous co-trimoxazole prophylaxis and 100 HIV-unexposed uninfected children who never received prophylaxis. We measured grade 3 and 4 serious adverse events and hospital admissions. All children were followed up to age 5 years and all analyses were by intention to treat. This study is registered with ClinicalTrials.gov, number NCT00527800. Findings 203 HIV-exposed infants were enrolled between Aug 10, 2007, and March 28, 2008. After breastfeeding ended, 185 children were not infected with HIV and were randomly assigned to stop (n=87) or continue (n=98) co-trimoxazole up to age 2 years. At age 2 years, 91 HIV-exposed children who had remained on co-trimoxazole prophylaxis were randomly assigned to discontinue (n=46) or continue (n=45) co-trimoxazole from age 2 years to age 4 years. We recorded 243 malaria episodes (2·91 per person-years) in the 45 HIV-exposed children assigned to continue co-trimoxazole until age 4 years compared with 503 episodes (5·60 per person-years) in the 46 children assigned to stop co-trimoxazole at age 2 years (incidence rate ratio 0·53, 95% CI 0·39–0·71; p<0·0001). There was no evidence of malaria incidence rebound in the year after discontinuation of co-trimoxazole in the HIV-exposed children who stopped co-trimoxazole at age 2 years, but incidence increased significantly in HIV-exposed children who stopped co-trimoxazole at age 4 years (odds ratio 1·78, 95% CI 1·19–2·66; p=0·005). Incidence of grade 3 or 4 serious adverse events, hospital admissions, or deaths did not significantly differ between HIV-exposed, HIV-unexposed, and HIV-infected children. Interpretation Continuation of co-trimoxazole prophylaxis up to 4 years of age seems safe and efficacious to protect HIV-exposed children living in malaria-endemic areas. Funding Centers for Disease Control and Prevention Global AIDS Program, Doris Duke Charitable Foundation