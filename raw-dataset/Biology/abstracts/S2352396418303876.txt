Background Miltefosine has been used successfully to treat visceral leishmaniasis (VL) in India, but it was unsuccessful for VL in a clinical trial in Brazil. Methods To identify molecular markers that predict VL treatment failure whole genome sequencing of 26 L. infantum isolates, from cured and relapsed patients allowed a GWAS analysis of SNPs, gene and chromosome copy number variations. Findings A strong association was identified (p = 0·0005) between the presence of a genetically stable L. infantum Miltefosine Sensitivity Locus (MSL), and a positive response to miltefosine treatment. The risk of treatment failure increased 9·4-fold (95% CI 2·11–53·54) when an isolate did not have the MSL. The complete absence of the MSL predicted miltefosine failure with 0·92 (95% CI 0·65–0·996) sensitivity and 0·78 (95% CI 0·52–0·92) specificity. A genotyping survey of L. infantum (n = 157) showed that the frequency of MSL varies in a cline from 95% in North East Brazil to <5% in the South East. The MSL was found in the genomes of all L. infantum and L. donovani sequenced isolates from the Old World (n = 671), where miltefosine can have a cure rate higher than 93%. Interpretation Knowledge on the presence or absence of the MSL in L. infantum will allow stratification of patients prior to treatment, helping to establish better therapeutic strategies for VL treatment. Fund CNPq, FAPES, GCRF MRC and Wellcome Trust.