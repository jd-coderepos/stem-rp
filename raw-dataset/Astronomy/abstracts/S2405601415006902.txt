QuarkNet is an educational program which brings high school teachers and their students into the particle physics research community. The program supports research experiences and professional development workshops and provides inquiry-oriented investigations, some using real experimental data. The CMS experiment at the LHC has released several thousand proton-proton collision events for use in education and outreach. QuarkNet, in collaboration with CMS, has developed a physics masterclass and e-Lab based on this data. A masterclass is a day-long educational workshop where high school students travel to nearby universities and research laboratories. There they learn from LHC physicists about the basics of particle physics and detectors. They then perform a simple measurement using LHC data, and share their results with other students around the world via videoconference. Since 2011 thousands of students from over 25 countries have participated in the CMS masterclass as organized by QuarkNet and the International Particle Physics Outreach Group (IPPOG).We describe here the masterclass exercise: the physics, the online event display and database preparation behind it, the measurement the students undertake, their results and experiences, and future plans for the exercise.