We introduce a vertex amplitude for 4d loop quantum gravity. We derive it from a conventional quantization of a Regge discretization of euclidean general relativity. This yields a spinfoam sum that corrects some difficulties of the Barrett–Crane theory. The second class simplicity constraints are imposed weakly, and not strongly as in Barrett–Crane theory. Thanks to a flip in the quantum algebra, the boundary states turn out to match those of SO ( 3 ) loop quantum gravity—the two can be identified as eigenstates of the same physical quantities—providing a solution to the problem of connecting the covariant SO ( 4 ) spinfoam formalism with the canonical SO ( 3 ) spin-network one. The vertex amplitude is SO ( 3 ) and SO ( 4 ) -covariant. It rectifies the triviality of the intertwiner dependence of the Barrett–Crane vertex, which is responsible for its failure to yield the correct propagator tensorial structure. The construction provides also an independent derivation of the kinematics of loop quantum gravity and of the result that geometry is quantized.