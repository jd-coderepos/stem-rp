Fragmentation, factorization and infrared poles in heavy quarkonium production 