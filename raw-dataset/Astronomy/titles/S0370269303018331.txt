A general theory of quantum relativity 